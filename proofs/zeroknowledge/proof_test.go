package zeroknowledge

import (
	"github.com/iden3/go-circuits"
	"github.com/iden3/go-iden3-auth/types"
	"github.com/stretchr/testify/assert"
	"testing"
)

func TestVerifyProof(t *testing.T) {

	var err error
	proofMessage := &types.ZeroKnowledgeProof{}
	proofMessage.CircuitID = circuits.KycBySignaturesCircuitID
	proofMessage.ProofData = &types.ProofData{
		A: []string{"10441536817202584897377823144827964642356918402871315490038163167310235469676",
			"3188873104904010906845899057040012497857652125001996465924027367142766788060",
			"1"},
		B: [][]string{{"10259767950868305572343651918722890484304440255374794205464892311274784569874",
			"18113532891970083775734522192028652126404157383671158241782353379080674688210",
		}, {
			"20011188305329655231409527762393912898857036946232895893305954758470171745705",
			"19212224402431449690017436050830610655559646158634403540885275057516508525272",
		}, {
			"1",
			"0",
		}},
		C: []string{"17410066358263445906462947561105622363737416663317734129930901016400750644236",
			"10889346016675221860511647187111664354773325795907973404602900127856769668544",
			"1",
		},
	}
	proofMessage.PubSignals = []string{"12345", "372902514040400364441393275265861152892555341750332828757240276565437644800", "19443506635601976434000063402326775248489014592264899338419890539515181882284", "840", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "0", "372902514040400364441393275265861152892555341750332828757240276565437644800", "19443506635601976434000063402326775248489014592264899338419890539515181882284", "2021", "4", "25"}

	proofMessage.Type = "zeroknowledge"

	err = VerifyProof(proofMessage)
	assert.Nil(t, err)

	err = ExtractMetadata(proofMessage)
	assert.Nil(t, err)
	assert.NotNil(t, proofMessage.AuthData)

}

func TestVerifyAuthProof(t *testing.T) {

	var err error
	proofMessage := &types.ZeroKnowledgeProof{}
	proofMessage.CircuitID = circuits.AuthCircuitID

	proofMessage.ProofData = &types.ProofData{
		A: []string{
			"11130843150540789299458990586020000719280246153797882843214290541980522375072",
			"1300841912943781723022032355836893831132920783788455531838254465784605762713",
			"1"},
		B: [][]string{
			{
				"20615768536988438336537777909042352056392862251785722796637590212160561351656",
				"10371144806107778890538857700855108667622042215096971747203105997454625814080",
			},
			{
				"19598541350804478549141207835028671111063915635580679694907635914279928677812",
				"15264553045517065669171584943964322117397645147006909167427809837929458012913",
			},
			{
				"1",
				"0",
			}},
		C: []string{
			"16443309279825508893086251290003936935077348754097470818523558082502364822049",
			"2984180227766048100510120407150752052334571876681304999595544138155611963273",
			"1",
		},
	}
	proofMessage.PubSignals = []string{
		"1",
		"18311560525383319719311394957064820091354976310599818797157189568621466950811",
		"323416925264666217617288569742564703632850816035761084002720090377353297920",
	}
	proofMessage.Type = "zeroknowledge"

	err = VerifyProof(proofMessage)
	assert.Nil(t, err)

	err = ExtractMetadata(proofMessage)
	assert.Nil(t, err)
	assert.NotNil(t, proofMessage.AuthData)

}
